<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rejig Commission Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 30px; }
        .header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
        .logo { height: 50px; }
        .header-text { flex: 1; }
        h1 { font-size: 28px; margin-bottom: 5px; color: #1a1a1a; }
        .subtitle { color: #666; font-size: 14px; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #05c68e; }
        .card.warning { border-left-color: #daba21; }
        .card-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .card-value { font-size: 24px; font-weight: 600; color: #1a1a1a; }
        .add-deal-form { background: #f8f9fa; padding: 20px; border-radius: 6px; margin-bottom: 20px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 12px; font-weight: 500; margin-bottom: 5px; color: #333; }
        .form-group input, .form-group select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .add-btn { background: #6537ca; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .section-toggle { background: none; border: none; color: #6537ca; font-size: 14px; cursor: pointer; padding: 0; margin-bottom: 15px; text-decoration: underline; }
        .deals-section { margin-bottom: 30px; }
        .deal-item { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 10px; display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 120px; gap: 15px; align-items: center; }
        .deal-item.churned { opacity: 0.5; background: #ffeaea; }
        .deal-name { font-weight: 500; }
        .deal-meta { font-size: 12px; color: #666; }
        .churn-input { padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; }
        .unchurn-btn { background: #05c68e; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .monthly-breakdown { margin-top: 30px; }
        .year-section { margin-bottom: 20px; }
        .year-header { background: #6537ca; color: white; padding: 15px 20px; border-radius: 6px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .year-header:hover { background: #5429ab; }
        .year-title { font-size: 20px; font-weight: 600; }
        .year-commission { font-size: 18px; }
        .expand-icon { transition: transform 0.2s; }
        .expand-icon.expanded { transform: rotate(180deg); }
        .month-card { background: white; border: 1px solid #e0e0e0; border-radius: 6px; padding: 20px; margin: 10px 0; cursor: pointer; }
        .month-card:hover { background: #f8f9fa; }
        .month-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #e0e0e0; }
        .month-title { font-size: 16px; font-weight: 500; color: #1a1a1a; }
        .month-commission { font-size: 18px; font-weight: 600; color: #05c68e; }
        .month-commission.zero { color: #999; }
        .month-details { font-size: 13px; color: #666; line-height: 1.6; }
        .revenue-bar { height: 8px; background: #e0e0e0; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        .revenue-fill { height: 100%; background: #05c68e; transition: width 0.3s; }
        .revenue-fill.under-threshold { background: #f15d55; }
        .deal-breakdown { margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0; }
        .deal-breakdown-item { padding: 8px; background: #f8f9fa; margin-bottom: 5px; border-radius: 4px; display: flex; justify-content: space-between; font-size: 13px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        
        const MONTHLY_THRESHOLD = 6666.67;
        const COMMISSION_RATE = 0.20;
        
        const initialDeals = [
            {id: 1, name: "Brian Shisler", close: "2025-07-01", subscription: 100, setup: 250, cycle: "monthly", churnDate: null},
            {id: 2, name: "Kelly Solberg", close: "2025-07-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 3, name: "Scott Armstrong", close: "2025-07-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 4, name: "Aline Roy", close: "2025-07-01", subscription: 150, setup: 250, cycle: "monthly", churnDate: null},
            {id: 5, name: "Julie Brown", close: "2025-07-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 6, name: "Grady Rohn", close: "2025-07-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 7, name: "Mary Beth Grasso", close: "2025-07-01", subscription: 900, setup: 0, cycle: "six-month", churnDate: null},
            {id: 8, name: "Avery Meizner", close: "2025-07-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 9, name: "Aaron Rose", close: "2025-08-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 10, name: "Scott Gaetner", close: "2025-08-01", subscription: 100, setup: 250, cycle: "monthly", churnDate: null},
            {id: 11, name: "Willie Adolph", close: "2025-08-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 12, name: "Kelly Calkins Roberts", close: "2025-08-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 13, name: "Barbara Wiedman", close: "2025-08-01", subscription: 900, setup: 0, cycle: "six-month", churnDate: null},
            {id: 14, name: "Sonia Silva", close: "2025-08-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 15, name: "Roz Rogers", close: "2025-08-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 16, name: "Jim Crotwell", close: "2025-08-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 17, name: "John Major", close: "2025-08-01", subscription: 100, setup: 250, cycle: "monthly", churnDate: null},
            {id: 18, name: "Phillip Vaughan", close: "2025-08-01", subscription: 100, setup: 250, cycle: "monthly", churnDate: null},
            {id: 19, name: "Erin Stevens", close: "2025-09-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 20, name: "Joseph Spurlock", close: "2025-09-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 21, name: "Davian Akers", close: "2025-09-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 22, name: "Nancy Quiroz", close: "2025-09-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 23, name: "Sarah Clear", close: "2025-09-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 24, name: "Jonathan Meek", close: "2025-10-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 25, name: "CJ Singh", close: "2025-10-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 26, name: "Ann Kraase", close: "2025-10-01", subscription: 1800, setup: 0, cycle: "yearly", churnDate: null},
            {id: 27, name: "Laura Miller Edwards", close: "2025-10-01", subscription: 120, setup: 0, cycle: "monthly", churnDate: null},
            {id: 28, name: "Cheryl Glynn", close: "2025-10-01", subscription: 80, setup: 0, cycle: "monthly", churnDate: null},
            {id: 29, name: "Robert Zahn", close: "2025-10-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 30, name: "Emmett Carr", close: "2025-10-01", subscription: 120, setup: 0, cycle: "monthly", churnDate: null},
            {id: 31, name: "Lisa Treu", close: "2025-10-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 32, name: "Patrick Higgins", close: "2025-10-01", subscription: 900, setup: 100, cycle: "six-month", churnDate: null},
            {id: 33, name: "Helena Gentila", close: "2025-11-01", subscription: 900, setup: 100, cycle: "six-month", churnDate: null},
            {id: 34, name: "Cyndee Haydon", close: "2025-11-01", subscription: 900, setup: 0, cycle: "six-month", churnDate: null},
            {id: 35, name: "Seb Ebrahimi", close: "2025-11-01", subscription: 900, setup: 0, cycle: "six-month", churnDate: null},
            {id: 36, name: "Jason Gracey", close: "2025-11-01", subscription: 1800, setup: 0, cycle: "yearly", churnDate: null},
            {id: 37, name: "Tass Fry", close: "2025-11-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 38, name: "Lisa Forss", close: "2025-11-01", subscription: 6480, setup: 0, cycle: "two-year", churnDate: null}
        ];
        
        const CommissionTracker = () => {
            const [deals, setDeals] = useState(() => {
                const saved = localStorage.getItem('commissionDeals');
                return saved ? JSON.parse(saved) : initialDeals;
            });
            const [expandedYears, setExpandedYears] = useState({'2025': true});
            const [expandedMonths, setExpandedMonths] = useState({});
            const [showDeals, setShowDeals] = useState(false);
            const [newDeal, setNewDeal] = useState({
                name: '',
                close: new Date().toISOString().split('T')[0],
                subscription: '',
                setup: '',
                cycle: 'six-month'
            });
            
            useEffect(() => {
                localStorage.setItem('commissionDeals', JSON.stringify(deals));
            }, [deals]);
            
            const addNewDeal = () => {
                if (!newDeal.name || !newDeal.subscription) return;
                
                const deal = {
                    id: Math.max(...deals.map(d => d.id), 0) + 1,
                    name: newDeal.name,
                    close: newDeal.close,
                    subscription: parseFloat(newDeal.subscription),
                    setup: parseFloat(newDeal.setup) || 0,
                    cycle: newDeal.cycle,
                    churnDate: null
                };
                
                setDeals([...deals, deal]);
                setNewDeal({
                    name: '',
                    close: new Date().toISOString().split('T')[0],
                    subscription: '',
                    setup: '',
                    cycle: 'six-month'
                });
            };
            
            const setChurnDate = (dealId, date) => {
                setDeals(deals.map(d => d.id === dealId ? {...d, churnDate: date} : d));
            };
            
            const removeChurn = (dealId) => {
                setDeals(deals.map(d => d.id === dealId ? {...d, churnDate: null} : d));
            };
            
            const monthlyBreakdown = useMemo(() => {
                const breakdown = {};
                const endDate = new Date('2027-12-31');
                
                deals.forEach(deal => {
                    const closeDate = new Date(deal.close);
                    const churnDate = deal.churnDate ? new Date(deal.churnDate) : null;
                    let currentDate = new Date(closeDate);
                    
                    let renewalMonths;
                    if (deal.cycle === "monthly") renewalMonths = 1;
                    else if (deal.cycle === "six-month") renewalMonths = 6;
                    else if (deal.cycle === "yearly") renewalMonths = 12;
                    else if (deal.cycle === "two-year") renewalMonths = 24;
                    
                    let isFirstPayment = true;
                    
                    while (currentDate <= endDate) {
                        if (churnDate && currentDate > churnDate) break;
                        
                        const monthKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
                        
                        if (!breakdown[monthKey]) {
                            breakdown[monthKey] = { revenue: 0, deals: [] };
                        }
                        
                        const amount = isFirstPayment ? deal.setup + deal.subscription : deal.subscription;
                        breakdown[monthKey].revenue += amount;
                        breakdown[monthKey].deals.push({
                            name: deal.name,
                            amount: amount,
                            type: isFirstPayment ? 'new' : 'renewal'
                        });
                        
                        isFirstPayment = false;
                        currentDate.setMonth(currentDate.getMonth() + renewalMonths);
                    }
                });
                
                Object.keys(breakdown).forEach(month => {
                    const revenue = breakdown[month].revenue;
                    breakdown[month].commission = revenue > MONTHLY_THRESHOLD ? 
                        (revenue - MONTHLY_THRESHOLD) * COMMISSION_RATE : 0;
                    breakdown[month].overThreshold = revenue - MONTHLY_THRESHOLD;
                });
                
                return breakdown;
            }, [deals]);
            
            const yearlyBreakdown = useMemo(() => {
                const years = {};
                Object.entries(monthlyBreakdown).forEach(([monthKey, data]) => {
                    const year = monthKey.split('-')[0];
                    if (!years[year]) {
                        years[year] = { commission: 0, revenue: 0, months: {} };
                    }
                    years[year].commission += data.commission;
                    years[year].revenue += data.revenue;
                    years[year].months[monthKey] = data;
                });
                return years;
            }, [monthlyBreakdown]);
            
            const totalCommission = Object.values(yearlyBreakdown).reduce((sum, y) => sum + y.commission, 0);
            const activeDeals = deals.filter(d => !d.churnDate || new Date(d.churnDate) > new Date());
            
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(amount);
            };
            
            const formatMonth = (monthKey) => {
                const [year, month] = monthKey.split('-');
                const date = new Date(year, parseInt(month) - 1);
                return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            };
            
            const toggleYear = (year) => {
                setExpandedYears({...expandedYears, [year]: !expandedYears[year]});
            };
            
            const toggleMonth = (monthKey) => {
                setExpandedMonths({...expandedMonths, [monthKey]: !expandedMonths[monthKey]});
            };
            
            return (
                <div className="container">
                    <div className="header">
                        <img src="data:image/png;base64,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+UD+n1L/H+rj/9Xh/x2v/8+Ufr+Y/93if+WS/yjv/4Os/xvC/23V/1n+f97+XxX+X//f/C/t/7lM/27k/mGc/5fT/1vT//e7/t/G/dv+f03/v/b91/y/0f/rq/+X6f9nrf+XC/3/Kvz/Mv//u/1/N//fbfh/rvb/Jvv/dvv/fvP/evn/ev1/jvu/E/2/W/pvdv+vwP8vif/fq+j/Jfz/3e7/l/T/cu//j+n/ves++v/h+P+D1f9n9f+b5f9fpf8/a/8/Xv+/q+j/lf//Xfl/d/1/D/y//Pt/gfy/7f3/rf6/u/xfF/f/K6v/Eul/xfH+/0D0/7Lmf9v7fwX0/0XS/02G/y+o/x+j/5/b/++G/19Z/P+s/V9b+v8V7v+m9f978//j/f92/P82/L+6/n9F/L8W/L/G/P9M73cT/X/L/b/S/n8l9/8n+vj/gfn/+P/8//o+w8I7/4P/SV7+H9T/n7T/n7H/Pxf+f5/9P4F/+5X/v0L/r7P/r+j/OfD/m/L/pfT/guj/c/H/R+n/+/v/D+P/h/P/W+//TdH/d0X/T+X/Kuj/U+r/O/X/b+j/m+j/peL/l8n/l5v/99P/t87/L+n/b8X/J+T/s/P/mfH/cuD/s+n/hdr/W/L/JPb/+vy/ZP5/HuH/6+n/O9r/q/r/h/b/+/n/Ru//s/D/c/r/M/T/W+n/b93/F5j/n6H/z8D/z4r/L4z/N8f/zyH/P5X/j/f/8/D/3fH/yvj/hPj/fPb/PP7/rPv/guz/Ze7/z+j/u9L/b+r/s/f/Suz/hf3/Fvv/xfn/Avx/gfH/M+n/i/X/Z+7/O8X/c/v/M+b/Wfn/kvj/Iv//av//Av5/WP8f3v9P3v8XlP+vTP8f2v8f6/+B/P+8/n/h/P+C/r9T/H+x+n+x/j9//58f/y/S/8eT/y+S/z+S/h+O/x+u/w/v/wn1///X/jdm+v/B+v/6+/+B/v9z/v9k+//1b/9/5f9f3P//vP3/5/X/Yf3//fb/w/j/z/D/XfX/p/D/5eP/L+j/7+v/5/z/s+v/3/f/u+3/Px/+/3P0/wt7/1P3/7C+f/38f+P/N98/d////M1//vzT/4/+Sv+fpf8/Xv+feP8fq/8/vv//vPz/Pv+/IP8/u/4/h/1/Nvy/LP//3P3/5+H/79v/l9T/7/f/x/z/0Pr/+P1Pvv/vb/7fgvT/8fz/cPv/zPx//P5/Wf8/v/+fsv///P6/Gv6/SP9/vPx/CfD/U/H/JfD/Bfv/ZPH/A/v/5fb/h9b/F/T/F+T/y+7/i8//F9T/n8X/R/f/o/H/A/P/cfv/svj/g/v/y///eP6/E/r/4/f/s/z/w/n/w/P/+/v/Zv//Pv//eP//t/v/i+f/S+r/z53/Lzb/33D+/8D8/+c=" className="logo" alt="Rejig.ai" />
                        <div className="header-text">
                            <h1>Commission Tracker</h1>
                            <p className="subtitle">Monthly threshold: {formatCurrency(MONTHLY_THRESHOLD)} | Commission rate: 20%</p>
                        </div>
                    </div>
                    
                    <div className="summary-cards">
                        <div className="card">
                            <div className="card-label">Active Deals</div>
                            <div className="card-value">{activeDeals.length} / {deals.length}</div>
                        </div>
                        <div className="card">
                            <div className="card-label">Total Commission Earned</div>
                            <div className="card-value">{formatCurrency(totalCommission)}</div>
                        </div>
                        <div className="card warning">
                            <div className="card-label">Months Over Threshold</div>
                            <div className="card-value">
                                {Object.values(monthlyBreakdown).filter(m => m.commission > 0).length}
                            </div>
                        </div>
                    </div>
                    
                    <div className="add-deal-form">
                        <h2 style={{marginBottom: '15px', fontSize: '18px'}}>Add New Deal</h2>
                        <div className="form-row">
                            <div className="form-group">
                                <label>Customer Name</label>
                                <input 
                                    type="text" 
                                    value={newDeal.name}
                                    onChange={(e) => setNewDeal({...newDeal, name: e.target.value})}
                                    placeholder="John Smith"
                                />
                            </div>
                            <div className="form-group">
                                <label>Close Date</label>
                                <input 
                                    type="date" 
                                    value={newDeal.close}
                                    onChange={(e) => setNewDeal({...newDeal, close: e.target.value})}
                                />
                            </div>
                            <div className="form-group">
                                <label>Subscription Amount</label>
                                <input 
                                    type="number" 
                                    value={newDeal.subscription}
                                    onChange={(e) => setNewDeal({...newDeal, subscription: e.target.value})}
                                    placeholder="600"
                                />
                            </div>
                            <div className="form-group">
                                <label>Setup Fee</label>
                                <input 
                                    type="number" 
                                    value={newDeal.setup}
                                    onChange={(e) => setNewDeal({...newDeal, setup: e.target.value})}
                                    placeholder="100"
                                />
                            </div>
                            <div className="form-group">
                                <label>Billing Cycle</label>
                                <select 
                                    value={newDeal.cycle}
                                    onChange={(e) => setNewDeal({...newDeal, cycle: e.target.value})}
                                >
                                    <option value="monthly">Monthly</option>
                                    <option value="six-month">6 Months</option>
                                    <option value="yearly">Yearly</option>
                                    <option value="two-year">2 Years</option>
                                </select>
                            </div>
                        </div>
                        <button className="add-btn" onClick={addNewDeal}>Add Deal</button>
                    </div>
                    
                    <div className="deals-section">
                        <button className="section-toggle" onClick={() => setShowDeals(!showDeals)}>
                            {showDeals ? 'Hide' : 'Show'} All Deals ({deals.length})
                        </button>
                        {showDeals && deals.map(deal => (
                            <div key={deal.id} className={`deal-item ${deal.churnDate ? 'churned' : ''}`}>
                                <div>
                                    <div className="deal-name">{deal.name}</div>
                                    <div className="deal-meta">
                                        Closed {new Date(deal.close).toLocaleDateString()} • {deal.cycle}
                                    </div>
                                </div>
                                <div>{formatCurrency(deal.subscription)} subscription</div>
                                <div>{formatCurrency(deal.setup)} setup</div>
                                <div>
                                    {deal.churnDate ? (
                                        <span style={{color: '#f15d55', fontSize: '13px'}}>
                                            Churned {new Date(deal.churnDate).toLocaleDateString()}
                                        </span>
                                    ) : (
                                        <span style={{color: '#05c68e', fontSize: '13px'}}>Active</span>
                                    )}
                                </div>
                                <div>
                                    {!deal.churnDate ? (
                                        <input 
                                            type="date" 
                                            className="churn-input"
                                            onChange={(e) => e.target.value && setChurnDate(deal.id, e.target.value)}
                                        />
                                    ) : (
                                        <button className="unchurn-btn" onClick={() => removeChurn(deal.id)}>
                                            Reactivate
                                        </button>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    <div className="monthly-breakdown">
                        <h2 style={{marginBottom: '20px', fontSize: '20px'}}>Commission Breakdown</h2>
                        {Object.keys(yearlyBreakdown).sort().reverse().map(year => (
                            <div key={year} className="year-section">
                                <div className="year-header" onClick={() => toggleYear(year)}>
                                    <div className="year-title">
                                        {year}
                                        <span className={`expand-icon ${expandedYears[year] ? 'expanded' : ''}`}> ▼</span>
                                    </div>
                                    <div className="year-commission">
                                        {formatCurrency(yearlyBreakdown[year].commission)} commission
                                    </div>
                                </div>
                                
                                {expandedYears[year] && Object.keys(yearlyBreakdown[year].months).sort().map(monthKey => {
                                    const data = yearlyBreakdown[year].months[monthKey];
                                    const percentOfThreshold = (data.revenue / MONTHLY_THRESHOLD) * 100;
                                    const isExpanded = expandedMonths[monthKey];
                                    
                                    return (
                                        <div key={monthKey} className="month-card">
                                            <div onClick={() => toggleMonth(monthKey)}>
                                                <div className="month-header">
                                                    <div className="month-title">
                                                        {formatMonth(monthKey)}
                                                        <span className={`expand-icon ${isExpanded ? 'expanded' : ''}`}> ▼</span>
                                                    </div>
                                                    <div className={`month-commission ${data.commission === 0 ? 'zero' : ''}`}>
                                                        {data.commission > 0 ? formatCurrency(data.commission) : 'No commission'}
                                                    </div>
                                                </div>
                                                
                                                <div className="revenue-bar">
                                                    <div 
                                                        className={`revenue-fill ${data.revenue <= MONTHLY_THRESHOLD ? 'under-threshold' : ''}`}
                                                        style={{width: `${Math.min(percentOfThreshold, 100)}%`}}
                                                    />
                                                </div>
                                                
                                                <div className="month-details">
                                                    Total Revenue: {formatCurrency(data.revenue)} 
                                                    {data.revenue > MONTHLY_THRESHOLD ? 
                                                        ` (${formatCurrency(data.overThreshold)} over threshold)` : 
                                                        ` (${formatCurrency(MONTHLY_THRESHOLD - data.revenue)} under threshold)`
                                                    }
                                                </div>
                                            </div>
                                            
                                            {isExpanded && (
                                                <div className="deal-breakdown">
                                                    {data.deals.map((d, i) => (
                                                        <div key={i} className="deal-breakdown-item">
                                                            <span>{d.name} ({d.type})</span>
                                                            <span>{formatCurrency(d.amount)}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        
        ReactDOM.render(<CommissionTracker />, document.getElementById('root'));
    </script>
</body>
</html>
