<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rejig Commission Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 30px; }
        h1 { font-size: 28px; margin-bottom: 10px; color: #1a1a1a; }
        .subtitle { color: #666; margin-bottom: 30px; font-size: 14px; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #4CAF50; }
        .card.warning { border-left-color: #ff9800; }
        .card-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .card-value { font-size: 24px; font-weight: 600; color: #1a1a1a; }
        .add-deal-form { background: #f8f9fa; padding: 20px; border-radius: 6px; margin-bottom: 20px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 12px; font-weight: 500; margin-bottom: 5px; color: #333; }
        .form-group input, .form-group select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .add-btn { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .section-toggle { background: none; border: none; color: #4CAF50; font-size: 14px; cursor: pointer; padding: 0; margin-bottom: 15px; text-decoration: underline; }
        .deals-section { margin-bottom: 30px; }
        .deal-item { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 10px; display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 120px; gap: 15px; align-items: center; }
        .deal-item.churned { opacity: 0.5; background: #ffeaea; }
        .deal-name { font-weight: 500; }
        .deal-meta { font-size: 12px; color: #666; }
        .churn-input { padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; }
        .churn-btn { background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .unchurn-btn { background: #4CAF50; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .monthly-breakdown { margin-top: 30px; }
        .month-card { background: white; border: 1px solid #e0e0e0; border-radius: 6px; padding: 20px; margin-bottom: 15px; cursor: pointer; }
        .month-card:hover { background: #f8f9fa; }
        .month-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #e0e0e0; }
        .month-title { font-size: 18px; font-weight: 600; color: #1a1a1a; }
        .month-commission { font-size: 20px; font-weight: 600; color: #4CAF50; }
        .month-commission.zero { color: #999; }
        .month-details { font-size: 13px; color: #666; line-height: 1.6; }
        .revenue-bar { height: 8px; background: #e0e0e0; border-radius: 4px; margin: 15px 0; overflow: hidden; position: relative; }
        .revenue-fill { height: 100%; background: #4CAF50; transition: width 0.3s; }
        .revenue-fill.under-threshold { background: #ff9800; }
        .deal-breakdown { margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0; }
        .deal-breakdown-item { padding: 8px; background: #f8f9fa; margin-bottom: 5px; border-radius: 4px; display: flex; justify-content: space-between; font-size: 13px; }
        .expand-icon { margin-left: 10px; transition: transform 0.2s; }
        .expand-icon.expanded { transform: rotate(180deg); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        
        const MONTHLY_THRESHOLD = 6666.67;
        const COMMISSION_RATE = 0.20;
        
        const initialDeals = [
            {id: 1, name: "Brian Shisler", close: "2025-07-01", subscription: 100, setup: 250, cycle: "monthly", churnDate: null},
            {id: 2, name: "Kelly Solberg", close: "2025-07-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 3, name: "Scott Armstrong", close: "2025-07-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 4, name: "Aline Roy", close: "2025-07-01", subscription: 150, setup: 250, cycle: "monthly", churnDate: null},
            {id: 5, name: "Julie Brown", close: "2025-07-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 6, name: "Grady Rohn", close: "2025-07-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 7, name: "Mary Beth Grasso", close: "2025-07-01", subscription: 900, setup: 0, cycle: "six-month", churnDate: null},
            {id: 8, name: "Avery Meizner", close: "2025-07-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 9, name: "Aaron Rose", close: "2025-08-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 10, name: "Scott Gaetner", close: "2025-08-01", subscription: 100, setup: 250, cycle: "monthly", churnDate: null},
            {id: 11, name: "Willie Adolph", close: "2025-08-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 12, name: "Kelly Calkins Roberts", close: "2025-08-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 13, name: "Barbara Wiedman", close: "2025-08-01", subscription: 900, setup: 0, cycle: "six-month", churnDate: null},
            {id: 14, name: "Sonia Silva", close: "2025-08-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 15, name: "Roz Rogers", close: "2025-08-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 16, name: "Jim Crotwell", close: "2025-08-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 17, name: "John Major", close: "2025-08-01", subscription: 100, setup: 250, cycle: "monthly", churnDate: null},
            {id: 18, name: "Phillip Vaughan", close: "2025-08-01", subscription: 100, setup: 250, cycle: "monthly", churnDate: null},
            {id: 19, name: "Erin Stevens", close: "2025-09-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 20, name: "Joseph Spurlock", close: "2025-09-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 21, name: "Davian Akers", close: "2025-09-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 22, name: "Nancy Quiroz", close: "2025-09-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 23, name: "Sarah Clear", close: "2025-09-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 24, name: "Jonathan Meek", close: "2025-10-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 25, name: "CJ Singh", close: "2025-10-01", subscription: 600, setup: 0, cycle: "six-month", churnDate: null},
            {id: 26, name: "Ann Kraase", close: "2025-10-01", subscription: 1800, setup: 0, cycle: "yearly", churnDate: null},
            {id: 27, name: "Laura Miller Edwards", close: "2025-10-01", subscription: 120, setup: 0, cycle: "monthly", churnDate: null},
            {id: 28, name: "Cheryl Glynn", close: "2025-10-01", subscription: 80, setup: 0, cycle: "monthly", churnDate: null},
            {id: 29, name: "Robert Zahn", close: "2025-10-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 30, name: "Emmett Carr", close: "2025-10-01", subscription: 120, setup: 0, cycle: "monthly", churnDate: null},
            {id: 31, name: "Lisa Treu", close: "2025-10-01", subscription: 1200, setup: 0, cycle: "yearly", churnDate: null},
            {id: 32, name: "Patrick Higgins", close: "2025-10-01", subscription: 900, setup: 100, cycle: "six-month", churnDate: null},
            {id: 33, name: "Helena Gentila", close: "2025-11-01", subscription: 900, setup: 100, cycle: "six-month", churnDate: null},
            {id: 34, name: "Cyndee Haydon", close: "2025-11-01", subscription: 900, setup: 0, cycle: "six-month", churnDate: null},
            {id: 35, name: "Seb Ebrahimi", close: "2025-11-01", subscription: 900, setup: 0, cycle: "six-month", churnDate: null},
            {id: 36, name: "Jason Gracey", close: "2025-11-01", subscription: 1800, setup: 0, cycle: "yearly", churnDate: null},
            {id: 37, name: "Tass Fry", close: "2025-11-01", subscription: 600, setup: 100, cycle: "six-month", churnDate: null},
            {id: 38, name: "Lisa Forss", close: "2025-11-01", subscription: 6480, setup: 0, cycle: "two-year", churnDate: null}
        ];
        
        const CommissionTracker = () => {
            const [deals, setDeals] = useState(() => {
                const saved = localStorage.getItem('commissionDeals');
                return saved ? JSON.parse(saved) : initialDeals;
            });
            const [expandedMonths, setExpandedMonths] = useState({});
            const [showDeals, setShowDeals] = useState(false);
            const [newDeal, setNewDeal] = useState({
                name: '',
                close: new Date().toISOString().split('T')[0],
                subscription: '',
                setup: '',
                cycle: 'six-month'
            });
            
            useEffect(() => {
                localStorage.setItem('commissionDeals', JSON.stringify(deals));
            }, [deals]);
            
            const addNewDeal = () => {
                if (!newDeal.name || !newDeal.subscription) return;
                
                const deal = {
                    id: Math.max(...deals.map(d => d.id), 0) + 1,
                    name: newDeal.name,
                    close: newDeal.close,
                    subscription: parseFloat(newDeal.subscription),
                    setup: parseFloat(newDeal.setup) || 0,
                    cycle: newDeal.cycle,
                    churnDate: null
                };
                
                setDeals([...deals, deal]);
                setNewDeal({
                    name: '',
                    close: new Date().toISOString().split('T')[0],
                    subscription: '',
                    setup: '',
                    cycle: 'six-month'
                });
            };
            
            const setChurnDate = (dealId, date) => {
                setDeals(deals.map(d => d.id === dealId ? {...d, churnDate: date} : d));
            };
            
            const removeChurn = (dealId) => {
                setDeals(deals.map(d => d.id === dealId ? {...d, churnDate: null} : d));
            };
            
            const monthlyBreakdown = useMemo(() => {
                const breakdown = {};
                const endDate = new Date('2027-12-31');
                
                deals.forEach(deal => {
                    const closeDate = new Date(deal.close);
                    const churnDate = deal.churnDate ? new Date(deal.churnDate) : null;
                    let currentDate = new Date(closeDate);
                    
                    let renewalMonths;
                    if (deal.cycle === "monthly") renewalMonths = 1;
                    else if (deal.cycle === "six-month") renewalMonths = 6;
                    else if (deal.cycle === "yearly") renewalMonths = 12;
                    else if (deal.cycle === "two-year") renewalMonths = 24;
                    
                    let isFirstPayment = true;
                    
                    while (currentDate <= endDate) {
                        if (churnDate && currentDate > churnDate) break;
                        
                        const monthKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
                        
                        if (!breakdown[monthKey]) {
                            breakdown[monthKey] = { revenue: 0, deals: [] };
                        }
                        
                        const amount = isFirstPayment ? deal.setup + deal.subscription : deal.subscription;
                        breakdown[monthKey].revenue += amount;
                        breakdown[monthKey].deals.push({
                            name: deal.name,
                            amount: amount,
                            type: isFirstPayment ? 'new' : 'renewal'
                        });
                        
                        isFirstPayment = false;
                        currentDate.setMonth(currentDate.getMonth() + renewalMonths);
                    }
                });
                
                Object.keys(breakdown).forEach(month => {
                    const revenue = breakdown[month].revenue;
                    breakdown[month].commission = revenue > MONTHLY_THRESHOLD ? 
                        (revenue - MONTHLY_THRESHOLD) * COMMISSION_RATE : 0;
                    breakdown[month].overThreshold = revenue - MONTHLY_THRESHOLD;
                });
                
                return breakdown;
            }, [deals]);
            
            const sortedMonths = Object.keys(monthlyBreakdown).sort();
            const totalCommission = Object.values(monthlyBreakdown).reduce((sum, m) => sum + m.commission, 0);
            const activeDeals = deals.filter(d => !d.churnDate || new Date(d.churnDate) > new Date());
            
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(amount);
            };
            
            const formatMonth = (monthKey) => {
                const [year, month] = monthKey.split('-');
                const date = new Date(year, parseInt(month) - 1);
                return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            };
            
            const toggleMonth = (monthKey) => {
                setExpandedMonths({...expandedMonths, [monthKey]: !expandedMonths[monthKey]});
            };
            
            return (
                <div className="container">
                    <h1>Commission Tracker</h1>
                    <p className="subtitle">Monthly threshold: {formatCurrency(MONTHLY_THRESHOLD)} | Commission rate: 20%</p>
                    
                    <div className="summary-cards">
                        <div className="card">
                            <div className="card-label">Active Deals</div>
                            <div className="card-value">{activeDeals.length} / {deals.length}</div>
                        </div>
                        <div className="card">
                            <div className="card-label">Total Commission Earned</div>
                            <div className="card-value">{formatCurrency(totalCommission)}</div>
                        </div>
                        <div className="card warning">
                            <div className="card-label">Months Over Threshold</div>
                            <div className="card-value">
                                {Object.values(monthlyBreakdown).filter(m => m.commission > 0).length}
                            </div>
                        </div>
                    </div>
                    
                    <div className="add-deal-form">
                        <h2 style={{marginBottom: '15px', fontSize: '18px'}}>Add New Deal</h2>
                        <div className="form-row">
                            <div className="form-group">
                                <label>Customer Name</label>
                                <input 
                                    type="text" 
                                    value={newDeal.name}
                                    onChange={(e) => setNewDeal({...newDeal, name: e.target.value})}
                                    placeholder="John Smith"
                                />
                            </div>
                            <div className="form-group">
                                <label>Close Date</label>
                                <input 
                                    type="date" 
                                    value={newDeal.close}
                                    onChange={(e) => setNewDeal({...newDeal, close: e.target.value})}
                                />
                            </div>
                            <div className="form-group">
                                <label>Subscription Amount</label>
                                <input 
                                    type="number" 
                                    value={newDeal.subscription}
                                    onChange={(e) => setNewDeal({...newDeal, subscription: e.target.value})}
                                    placeholder="600"
                                />
                            </div>
                            <div className="form-group">
                                <label>Setup Fee</label>
                                <input 
                                    type="number" 
                                    value={newDeal.setup}
                                    onChange={(e) => setNewDeal({...newDeal, setup: e.target.value})}
                                    placeholder="100"
                                />
                            </div>
                            <div className="form-group">
                                <label>Billing Cycle</label>
                                <select 
                                    value={newDeal.cycle}
                                    onChange={(e) => setNewDeal({...newDeal, cycle: e.target.value})}
                                >
                                    <option value="monthly">Monthly</option>
                                    <option value="six-month">6 Months</option>
                                    <option value="yearly">Yearly</option>
                                    <option value="two-year">2 Years</option>
                                </select>
                            </div>
                        </div>
                        <button className="add-btn" onClick={addNewDeal}>Add Deal</button>
                    </div>
                    
                    <div className="deals-section">
                        <button className="section-toggle" onClick={() => setShowDeals(!showDeals)}>
                            {showDeals ? 'Hide' : 'Show'} All Deals ({deals.length})
                        </button>
                        {showDeals && deals.map(deal => (
                            <div key={deal.id} className={`deal-item ${deal.churnDate ? 'churned' : ''}`}>
                                <div>
                                    <div className="deal-name">{deal.name}</div>
                                    <div className="deal-meta">
                                        Closed {new Date(deal.close).toLocaleDateString()} • {deal.cycle}
                                    </div>
                                </div>
                                <div>{formatCurrency(deal.subscription)} subscription</div>
                                <div>{formatCurrency(deal.setup)} setup</div>
                                <div>
                                    {deal.churnDate ? (
                                        <span style={{color: '#f44336', fontSize: '13px'}}>
                                            Churned {new Date(deal.churnDate).toLocaleDateString()}
                                        </span>
                                    ) : (
                                        <span style={{color: '#4CAF50', fontSize: '13px'}}>Active</span>
                                    )}
                                </div>
                                <div>
                                    {!deal.churnDate ? (
                                        <input 
                                            type="date" 
                                            className="churn-input"
                                            onChange={(e) => e.target.value && setChurnDate(deal.id, e.target.value)}
                                        />
                                    ) : (
                                        <button className="unchurn-btn" onClick={() => removeChurn(deal.id)}>
                                            Reactivate
                                        </button>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    {sortedMonths.length > 0 && (
                        <div className="monthly-breakdown">
                            <h2 style={{marginBottom: '20px', fontSize: '20px'}}>Monthly Commission Breakdown</h2>
                            {sortedMonths.map(month => {
                                const data = monthlyBreakdown[month];
                                const percentOfThreshold = (data.revenue / MONTHLY_THRESHOLD) * 100;
                                const isExpanded = expandedMonths[month];
                                
                                return (
                                    <div key={month} className="month-card">
                                        <div onClick={() => toggleMonth(month)}>
                                            <div className="month-header">
                                                <div className="month-title">
                                                    {formatMonth(month)}
                                                    <span className={`expand-icon ${isExpanded ? 'expanded' : ''}`}>▼</span>
                                                </div>
                                                <div className={`month-commission ${data.commission === 0 ? 'zero' : ''}`}>
                                                    {data.commission > 0 ? formatCurrency(data.commission) : 'No commission'}
                                                </div>
                                            </div>
                                            
                                            <div className="revenue-bar">
                                                <div 
                                                    className={`revenue-fill ${data.revenue <= MONTHLY_THRESHOLD ? 'under-threshold' : ''}`}
                                                    style={{width: `${Math.min(percentOfThreshold, 100)}%`}}
                                                />
                                            </div>
                                            
                                            <div className="month-details">
                                                Total Revenue: {formatCurrency(data.revenue)} 
                                                {data.revenue > MONTHLY_THRESHOLD ? 
                                                    ` (${formatCurrency(data.overThreshold)} over threshold)` : 
                                                    ` (${formatCurrency(MONTHLY_THRESHOLD - data.revenue)} under threshold)`
                                                }
                                            </div>
                                        </div>
                                        
                                        {isExpanded && (
                                            <div className="deal-breakdown">
                                                {data.deals.map((d, i) => (
                                                    <div key={i} className="deal-breakdown-item">
                                                        <span>{d.name} ({d.type})</span>
                                                        <span>{formatCurrency(d.amount)}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        };
        
        ReactDOM.render(<CommissionTracker />, document.getElementById('root'));
    </script>
</body>
</html>
